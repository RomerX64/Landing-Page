"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[852],{3932:(e,r,t)=>{t.d(r,{A:()=>o});let a=t(2651).A.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let r=localStorage.getItem("token");r&&(e.headers.Authorization="Bearer ".concat(r))}return e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>Promise.reject(e));let o=a},8232:(e,r,t)=>{t.d(r,{a:()=>c,g:()=>u});var a=t(5155),o=t(2115),s=t(4357),l=t(3932),n=t(2155),i=t(1455);let c=(0,o.createContext)({sub:null,planes:[],viewPlan:null,suscribirse:async()=>{},desuscribirse:async()=>{},selectPlan:async()=>null,changePlan:()=>{}}),u=e=>{let{children:r}=e,{user:t}=(0,o.useContext)(i.R),[u,d]=(0,o.useState)(null),[g,m]=(0,o.useState)([]),[p,w]=(0,o.useState)(null);(0,o.useEffect)(()=>{(0,s.Lz)("TEST-450aba78-55dc-4623-9975-99be4b21f666")},[]);let h=(0,o.useCallback)(async()=>{try{let e=localStorage.getItem("planes");if(e){let r=JSON.parse(e);m(r),console.log("Planes cargados desde LocalStorage");return}let{data:r,error:t}=await (0,n.$)(l.A.get("/users/planes"));if(t||!(null==r?void 0:r.data)){console.error("Error al obtener planes:",t||"No se retornaron datos");return}let a=r.data;m(a),localStorage.setItem("planes",JSON.stringify(a))}catch(e){console.error("Error en getPlanes:",e)}},[]),f=(0,o.useCallback)(async(e,r)=>{try{var a;let{data:o,error:s}=await (0,n.$)(l.A.post("/subscriptions",{planId:e,userEmail:null==t?void 0:t.email,paymentMethodToken:r}));if(s||!(null==o?void 0:null===(a=o.data)||void 0===a?void 0:a.subscription)){console.error("Error al suscribirse:",s||"No se retornaron datos");return}let i=o.data.subscription;d(i),localStorage.setItem("subscripcion",JSON.stringify(i))}catch(e){console.error("Excepci\xf3n en suscribirse:",e)}},[t]),y=(0,o.useCallback)(async()=>{if(u)try{var e;let{data:r,error:t}=await (0,n.$)(l.A.post("/subscriptions/cancel",{subscriptionId:u.mercadopagoSubscriptionId,cancellationReason:"Cancelaci\xf3n solicitada por el usuario"}));if(t||!(null==r?void 0:null===(e=r.data)||void 0===e?void 0:e.subscription)){console.error("Error al desuscribirse:",t||"No se retornaron datos");return}d(null),localStorage.removeItem("subscripcion")}catch(e){console.error("Excepci\xf3n en desuscribirse:",e)}},[u]),b=(0,o.useCallback)(async e=>{0===g.length&&await h();let r=g.find(r=>r.id===e);return r?(w(r),localStorage.setItem("viewPlan",JSON.stringify(r)),r):(console.error("Plan no encontrado"),null)},[g,h]),S=(0,o.useCallback)(e=>{if(!p||0===g.length)return;let r=g.findIndex(e=>e.id===p.id);if(-1===r)return;let t="next"===e?r+1:r-1;t<0&&(t=g.length-1),t>=g.length&&(t=0);let a=g[t];w(a),localStorage.setItem("viewPlan",JSON.stringify(a))},[g,p]);(0,o.useEffect)(()=>{let e=localStorage.getItem("subscripcion");e&&d(JSON.parse(e)),h()},[t,h]),(0,o.useEffect)(()=>{if(g.length>0&&!p){let e=localStorage.getItem("viewPlan");e?w(JSON.parse(e)):w(g.find(e=>!0===e.popular)||g[0])}},[g,p]);let E=(0,o.useMemo)(()=>({sub:u,planes:g,viewPlan:p,suscribirse:f,desuscribirse:y,selectPlan:b,changePlan:S}),[u,g,p,f,y,b,S]);return(0,a.jsx)(c.Provider,{value:E,children:r})}},1455:(e,r,t)=>{t.d(r,{R:()=>i,v:()=>c});var a=t(5155),o=t(2115),s=t(3932),l=t(2155),n=t(2615);let i=(0,o.createContext)({token:"",user:null,signInO:async()=>{throw Error("Not implemented")},signUp:async()=>{throw Error("Not implemented")},deleteUser:async()=>{throw Error("Not implemented")},mailIsValid:async()=>{throw Error("Not implemented")},updateUser:async()=>{throw Error("Not implemented")},signOut:async()=>{throw Error("Not implemented")},signInWithGoogle:async()=>{throw Error("Not implemented")},signUpWithGoogle:async()=>{throw Error("Not implemented")},requestResetPassword:async()=>{throw Error("Not implemented")},resetPassword:async()=>{throw Error("Not implemented")}}),c=e=>{let{children:r}=e,{data:t}=(0,n.useSession)(),[c,u]=(0,o.useState)(null),[d,g]=(0,o.useState)(""),[m,p]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(m)return;let e=localStorage.getItem("token"),r=localStorage.getItem("user");if(e&&g(e),r)try{u(JSON.parse(r))}catch(e){console.error("Error al parsear el usuario del localStorage",e)}if(null==t?void 0:t.user){let{email:e,name:r}=t.user;w(e,r)}},[t,m]);let w=(0,o.useCallback)(async(e,r)=>{try{let{data:t,error:a}=await (0,l.$)(s.A.get("users/email/get/".concat(e)));if(a)return console.warn("Error al consultar existencia del usuario:",a.message),null;if(null==t?void 0:t.data){let{data:r,error:t}=await (0,l.$)(s.A.get("/users/get/".concat(e)));if(t||!r)return console.log("Error al traer el usuario:",null==t?void 0:t.message),null;return u(r.data.User),g(r.data.token),localStorage.setItem("token",r.data.token),localStorage.setItem("user",JSON.stringify(r.data)),r.data}let{data:o,error:n}=await (0,l.$)(s.A.post("/users/crearUser/google",{email:e,name:r}));if(n||!o)return console.log("Error al crear el usuario:",null==n?void 0:n.message),null;return u(o.data),localStorage.setItem("user",JSON.stringify(o.data)),o.data}catch(e){return console.error("Error en el proceso de registro:",e),null}},[]),h=(0,o.useCallback)(async e=>{let{data:r,error:t}=await (0,l.$)(s.A.post("/users/signIn",e));if(t||!r)throw Error(t.message||"Hubo un error al iniciar sesi\xf3n.");let{User:a,token:o}=(null==r?void 0:r.data)||{};if(!a||!o)throw Error("Los datos de autenticaci\xf3n son inv\xe1lidos.");return g(o),u(a),localStorage.setItem("token",o),localStorage.setItem("user",JSON.stringify(a)),a},[]),f=(0,o.useCallback)(async e=>{let{data:r,error:t}=await (0,l.$)(s.A.post("/users/signUp",e));if(t||!r)throw Error(t.message||"Hubo un error al registrarse.");let{User:a,token:o}=r.data;return g(o),u(a),localStorage.setItem("token",o),localStorage.setItem("user",JSON.stringify(a)),a},[]),y=(0,o.useCallback)(async e=>{let{data:r,error:t}=await (0,l.$)(s.A.delete("/users/user",{data:e}));if(t||!r)throw Error(t.message||"Hubo un error al eliminar el usuario.");let a=r.data;return g(""),u(null),localStorage.removeItem("token"),localStorage.removeItem("user"),a},[]),b=(0,o.useCallback)(async e=>{try{return(await s.A.get("/users/email/".concat(e))).data}catch(e){return!1}},[]),S=(0,o.useCallback)(async e=>{if(!(null==c?void 0:c.id))throw Error("El usuario no est\xe1 autenticado.");let{data:r,error:t}=await (0,l.$)(s.A.post("/users/update",{...e,id:c.id}));if(t||!r)throw Error(t.message||"Hubo un error al actualizar el usuario.");let{User:a,token:o}=r.data;return g(o),u(a),localStorage.setItem("token",o),localStorage.setItem("user",JSON.stringify(a)),a},[c]),E=(0,o.useCallback)(async()=>{await (0,n.signOut)({redirect:!1}),g(""),u(null),localStorage.removeItem("token"),localStorage.removeItem("user"),p(!0)},[]),k=(0,o.useCallback)(async()=>{try{await (0,n.signIn)("google",{callbackUrl:"/"});let e=await (0,n.getSession)();if(!e||!e.user)throw Error("No se pudo obtener la sesi\xf3n del usuario.");let{email:r,name:t}=e.user;return w(r,t)}catch(e){return console.error("Error en signInWithGoogle:",e),null}},[w]),v=(0,o.useCallback)(async()=>{try{await (0,n.signIn)("google",{callbackUrl:"/"});let e=await (0,n.getSession)();if(!e||!e.user)throw Error("No se pudo obtener la sesi\xf3n del usuario.");let{email:r,name:t}=e.user;return w(r,t)}catch(e){return console.error("Error en signUpWithGoogle:",e),null}},[w]),N=(0,o.useCallback)(async e=>{let{data:r,error:t}=await (0,l.$)(s.A.post("/users/request-reset-password",{email:e}));if(t||!r)throw Error(t.message||"Error al solicitar reset de contrase\xf1a");return r.data},[]),I=(0,o.useCallback)(async(e,r)=>{let{data:t,error:a}=await (0,l.$)(s.A.post("/users/reset-password",{token:e,newPassword:r}));if(a||!t)throw Error(a.message||"Error al resetear la contrase\xf1a");return t.data},[]),C=(0,o.useMemo)(()=>({token:d,user:c,signInO:h,signUp:f,deleteUser:y,mailIsValid:b,updateUser:S,signOut:E,signInWithGoogle:k,signUpWithGoogle:v,requestResetPassword:N,resetPassword:I}),[d,c,h,f,y,b,S,E,k,v,N,I]);return(0,a.jsx)(i.Provider,{value:C,children:r})}},2155:(e,r,t)=>{t.d(r,{$:()=>a});let a=async e=>{try{return{data:await e}}catch(e){return console.error("Error en handleAsync:",e),{error:e.response?e.response.data:{message:e.message}}}}},4057:(e,r,t)=>{t.d(r,{A:()=>i});var a=t(2115);let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,a.forwardRef)((e,r)=>{let{color:t="currentColor",size:o=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:c="",children:u,iconNode:d,...g}=e;return(0,a.createElement)("svg",{ref:r,...l,width:o,height:o,stroke:t,strokeWidth:i?24*Number(n)/Number(o):n,className:s("lucide",c),...g},[...d.map(e=>{let[r,t]=e;return(0,a.createElement)(r,t)}),...Array.isArray(u)?u:[u]])}),i=(e,r)=>{let t=(0,a.forwardRef)((t,l)=>{let{className:i,...c}=t;return(0,a.createElement)(n,{ref:l,iconNode:r,className:s("lucide-".concat(o(e)),i),...c})});return t.displayName="".concat(e),t}}}]);