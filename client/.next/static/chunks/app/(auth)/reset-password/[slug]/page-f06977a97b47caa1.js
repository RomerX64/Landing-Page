(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2880],{8836:(e,r,t)=>{Promise.resolve().then(t.bind(t,5146))},5146:(e,r,t)=>{"use strict";t.d(r,{ResetPasswordConfirm:()=>g});var a=t(5155),s=t(2115),o=t(1455),l=t(6046),n=t(8173),i=t.n(n),c=t(654),d=t(3261),u=t(7752),m=t(632),h=t(2783);let g=()=>{let{resetPassword:e}=(0,s.useContext)(o.Rs),r=(0,l.useRouter)(),t=(0,l.useParams)(),n=null==t?void 0:t.slug,[g,x]=(0,s.useState)(""),[p,y]=(0,s.useState)(""),[f,w]=(0,s.useState)("idle"),[b,v]=(0,s.useState)(""),[E,k]=(0,s.useState)(!1),[N,j]=(0,s.useState)(!0),[A,S]=(0,s.useState)(!0),[C,P]=(0,s.useState)(!0);(0,s.useEffect)(()=>{n||(j(!1),v("Token de restablecimiento no encontrado"))},[n]),(0,s.useEffect)(()=>{S(g.length>=5),P(g===p)},[g,p]);let I=async t=>{if(t.preventDefault(),!n){w("error"),v("Token de restablecimiento no encontrado");return}if(!A){w("error"),v("La contrase\xf1a debe tener al menos 5 caracteres");return}if(!C){w("error"),v("Las contrase\xf1as no coinciden");return}w("loading");try{let t=await e(n,g);w("success"),v(t.message||"Contrase\xf1a restablecida correctamente"),setTimeout(()=>{r.push("/signin")},2e3)}catch(e){w("error"),v(e.message||"Error al restablecer la contrase\xf1a")}};return N?(0,a.jsx)("section",{children:(0,a.jsx)("div",{className:"max-w-6xl px-4 mx-auto sm:px-6",children:(0,a.jsxs)("div",{className:"py-12 md:py-20",children:[(0,a.jsx)("div",{className:"pb-12 text-center",children:(0,a.jsx)("h1",{className:"animate-[gradient_6s_linear_infinite] bg-[linear-gradient(to_right,theme(colors.gray.200),theme(colors.indigo.200),theme(colors.gray.50),theme(colors.indigo.300),theme(colors.gray.200))] bg-[length:200%_auto] bg-clip-text font-nacelle text-3xl font-semibold text-transparent md:text-4xl",children:"Establecer nueva contrase\xf1a"})}),"success"===f?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center mx-auto max-w-[400px]",children:[(0,a.jsx)(d.A,{className:"w-16 h-16 mb-4 text-green-500"}),(0,a.jsx)("p",{className:"mb-6 text-indigo-200/65",children:b}),(0,a.jsx)("p",{className:"text-indigo-200/65",children:"Redirigiendo al inicio de sesi\xf3n..."})]}):"error"===f?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center mx-auto max-w-[400px]",children:[(0,a.jsx)(c.A,{className:"w-16 h-16 mb-4 text-red-500"}),(0,a.jsx)("p",{className:"mb-6 text-red-400",children:b}),b.includes("expirado")||b.includes("inv\xe1lido")?(0,a.jsx)(i(),{href:"/reset-password",className:"btn bg-gradient-to-t from-indigo-600 to-indigo-500 text-white hover:bg-[length:100%_150%]",children:"Solicitar nuevo restablecimiento"}):(0,a.jsx)("button",{onClick:()=>w("idle"),className:"btn bg-gradient-to-t from-indigo-600 to-indigo-500 text-white hover:bg-[length:100%_150%]",children:"Intentar de nuevo"})]}):(0,a.jsxs)("form",{onSubmit:I,className:"mx-auto max-w-[400px]",children:[(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"newPassword",className:"block mb-1 text-sm font-medium text-indigo-200/65",children:"Nueva contrase\xf1a"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{id:"newPassword",type:E?"text":"password",className:"w-full pr-10 form-input",placeholder:"M\xednimo 5 caracteres",value:g,onChange:e=>x(e.target.value),required:!0}),(0,a.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 flex items-center px-3 text-indigo-200/65",onClick:()=>{k(!E)},children:E?(0,a.jsx)(u.A,{className:"w-5 h-5"}):(0,a.jsx)(m.A,{className:"w-5 h-5"})})]}),!A&&g.length>0&&(0,a.jsx)("span",{className:"text-xs text-red-500",children:"La contrase\xf1a debe tener al menos 5 caracteres"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block mb-1 text-sm font-medium text-indigo-200/65",children:"Confirmar contrase\xf1a"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{id:"confirmPassword",type:E?"text":"password",className:"w-full pr-10 form-input",placeholder:"Repita la contrase\xf1a",value:p,onChange:e=>y(e.target.value),required:!0})}),!C&&p.length>0&&(0,a.jsx)("span",{className:"text-xs text-red-500",children:"Las contrase\xf1as no coinciden"})]})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{type:"submit",className:"btn w-full bg-gradient-to-t from-indigo-600 to-indigo-500 text-white hover:bg-[length:100%_150%]",disabled:"loading"===f,children:"loading"===f?(0,a.jsx)(h.A,{className:"w-5 h-5 animate-spin"}):"Restablecer contrase\xf1a"})})]})]})})}):(0,a.jsx)("section",{children:(0,a.jsx)("div",{className:"max-w-6xl px-4 mx-auto sm:px-6",children:(0,a.jsx)("div",{className:"py-12 md:py-20",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center mx-auto max-w-[400px]",children:[(0,a.jsx)(c.A,{className:"w-16 h-16 mb-4 text-red-500"}),(0,a.jsx)("p",{className:"mb-6 text-red-400",children:b}),(0,a.jsx)(i(),{href:"/reset-password",className:"btn bg-gradient-to-t from-indigo-600 to-indigo-500 text-white hover:bg-[length:100%_150%]",children:"Solicitar nuevo restablecimiento"})]})})})})}},1455:(e,r,t)=>{"use strict";t.d(r,{Ay:()=>u,Rs:()=>c,vu:()=>d});var a=t(5155),s=t(2115),o=t(2793),l=t(2155),n=t(2615),i=t(9208);let c=(0,s.createContext)({token:"",user:null,signInO:async()=>{throw Error("Not implemented")},signUp:async()=>{throw Error("Not implemented")},deleteUser:async()=>{throw Error("Not implemented")},mailIsValid:async()=>{throw Error("Not implemented")},updateUser:async()=>{throw Error("Not implemented")},signOut:async()=>{throw Error("Not implemented")},signInWithGoogle:async()=>{throw Error("Not implemented")},signUpWithGoogle:async()=>{throw Error("Not implemented")},requestResetPassword:async()=>{throw Error("Not implemented")},resetPassword:async()=>{throw Error("Not implemented")},verifyEmail:async()=>{throw Error("Not implemented")},initiatePasswordReset:async()=>{throw Error("Not implemented")},isLoading:!1}),d=e=>{let{children:r}=e,{data:t}=(0,n.useSession)(),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(""),[g,x]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{if(t&&t.user&&!d)try{x(!0);let{email:e,name:r}=t.user;e&&r&&await f(e,r)}catch(e){console.error("Error al procesar la sesi\xf3n de Google:",e)}finally{x(!1)}})()},[t,d]),(0,s.useEffect)(()=>{let e=localStorage.getItem("token")||i.A.get("token"),r=localStorage.getItem("user")||i.A.get("user");if(e&&h(e),r)try{u(JSON.parse(r))}catch(e){console.error("Error al parsear el usuario del localStorage o cookie",e)}},[]);let p=(0,s.useCallback)((e,r)=>{localStorage.setItem("token",r),localStorage.setItem("user",JSON.stringify(e)),i.A.set("token",r,{expires:7}),i.A.set("user",JSON.stringify(e),{expires:7})},[]),y=(0,s.useCallback)(()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),i.A.remove("token"),i.A.remove("user"),Object.keys(localStorage).forEach(e=>{e.startsWith("subscripcion_")&&localStorage.removeItem(e)})},[]),f=(0,s.useCallback)(async(e,r)=>{try{x(!0);let{data:t,error:a}=await (0,l.$)(o.A.get("users/email/get/".concat(e)));if(a)throw Error(a.message);if(null==t?void 0:t.data){let{data:r,error:t}=await (0,l.$)(o.A.get("/users/get/".concat(e)));if(t||!r)throw Error((null==t?void 0:t.message)||"Error al obtener usuario existente");return u(r.data.User),h(r.data.token),p(r.data.User,r.data.token),r.data.User}let{data:s,error:n}=await (0,l.$)(o.A.post("/users/crearUser/google",{email:e,name:r}));if(n||!s)throw Error((null==n?void 0:n.message)||"Error al crear usuario");return u(s.data),h(s.data.token),p(s.data,s.data.token),s.data}catch(e){throw console.error("Error en el proceso de registro:",e),e}finally{x(!1)}},[p]),w=(0,s.useCallback)(async e=>{try{x(!0);let{data:r,error:t}=await (0,l.$)(o.A.post("/users/signIn",e));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error de inicio de sesi\xf3n");let{User:a,token:s}=r.data;return h(s),u(a),p(a,s),a}catch(e){return console.error("Error en signIn:",e),null}finally{x(!1)}},[p]),b=(0,s.useCallback)(async e=>{try{x(!0);let{data:r,error:t}=await (0,l.$)(o.A.post("/users/signUp",e));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error de registro");let{user:a,token:s}=r.data;return h(s),u(a),p(a,s),a}catch(e){throw console.error("Error en signUp:",e),e}finally{x(!1)}},[p]),v=(0,s.useCallback)(async e=>{try{x(!0);let{data:r,error:t}=await (0,l.$)(o.A.delete("/users/user",{data:e}));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error al eliminar usuario");let a=r.data;return h(""),u(null),y(),a}catch(e){throw console.error("Error al eliminar usuario:",e),e}finally{x(!1)}},[y]),E=(0,s.useCallback)(async e=>{try{return x(!0),(await o.A.get("/users/email/".concat(e))).data}catch(e){return!1}finally{x(!1)}},[]),k=(0,s.useCallback)(async e=>{if(!(null==d?void 0:d.id))throw Error("Usuario no autenticado");try{x(!0);let{data:r,error:t}=await (0,l.$)(o.A.put("/users/update/".concat(d.id),{...e}));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error al actualizar usuario");let{user:a,token:s}=r.data;return a&&(u(a),p(a,s||m)),a}catch(e){throw console.error("Error al actualizar usuario:",e),e}finally{x(!1)}},[d,p,m]),N=(0,s.useCallback)(async()=>{try{x(!0),await (0,n.signOut)({redirect:!1}),h(""),u(null),y()}catch(e){console.error("Error durante el cierre de sesi\xf3n:",e)}finally{x(!1)}},[y]),j=(0,s.useCallback)(async()=>{try{return x(!0),await (0,n.signIn)("google",{callbackUrl:"/"}),null}catch(e){return console.error("Error en signInWithGoogle:",e),null}finally{x(!1)}},[]),A=(0,s.useCallback)(async()=>j(),[j]),S=(0,s.useCallback)(async e=>{try{x(!0);let{data:r,error:t}=await (0,l.$)(o.A.post("/users/verify-email",{token:e}));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error al verificar email");if(d&&d.id===r.data.user.id){let e={...r.data.user};u(e),localStorage.setItem("user",JSON.stringify(e)),i.A.set("user",JSON.stringify(e),{expires:7})}return r.data}catch(e){throw console.error("Error al verificar email:",e),e}finally{x(!1)}},[d]),C=(0,s.useCallback)(async e=>{try{x(!0);let{data:r,error:t}=await (0,l.$)(o.A.get("/users/initiate-password-reset/".concat(e)));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error al solicitar restablecimiento de contrase\xf1a");return r.data}catch(e){throw console.error("Error al iniciar restablecimiento de contrase\xf1a:",e),e}finally{x(!1)}},[]),P=(0,s.useCallback)(async(e,r)=>{try{x(!0);let{data:t,error:a}=await (0,l.$)(o.A.post("/users/reset-password",{token:e,newPassword:r}));if(a||!(null==t?void 0:t.data))throw Error((null==a?void 0:a.message)||"Error al restablecer contrase\xf1a");return t.data}catch(e){throw console.error("Error al restablecer contrase\xf1a:",e),e}finally{x(!1)}},[]),I=(0,s.useMemo)(()=>({token:m,user:d,signInO:w,signUp:b,deleteUser:v,mailIsValid:E,updateUser:k,signOut:N,signInWithGoogle:j,signUpWithGoogle:A,verifyEmail:S,initiatePasswordReset:C,resetPassword:P,requestResetPassword:C,isLoading:g}),[m,d,w,b,v,E,k,N,j,A,S,C,P,g]);return(0,a.jsx)(c.Provider,{value:I,children:r})},u=c},6046:(e,r,t)=>{"use strict";var a=t(6658);t.o(a,"useParams")&&t.d(r,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},2793:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let a=t(2651).A.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let r=localStorage.getItem("token");r&&(e.headers.Authorization="Bearer ".concat(r))}return e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>Promise.reject(e));let s=a},2155:(e,r,t)=>{"use strict";t.d(r,{$:()=>a});let a=async e=>{try{return{data:await e}}catch(e){return console.error("Error en handleAsync:",e),{error:e.response?e.response.data:{message:e.message}}}}},3261:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(4057).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},654:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(4057).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},7752:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(4057).A)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])},632:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(4057).A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2783:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(4057).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},e=>{var r=r=>e(e.s=r);e.O(0,[2651,8014,7125,8441,1517,7358],()=>r(8836)),_N_E=e.O()}]);