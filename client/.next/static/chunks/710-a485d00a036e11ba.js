"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[710],{710:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var a=r(5155),s=r(6046),l=r(2115);let n=e=>{let{getAllPlans:t,deletePlan:r}=e,n=(0,s.useRouter)(),[i,o]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{try{let e=await t();o(e)}catch(e){console.error("Error fetching plans:",e)}})()},[t]);let c=async e=>{try{await r(e),o(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Error al eliminar el plan:",e)}};return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.length>0?i.map(e=>(0,a.jsxs)("div",{className:"p-4 bg-gray-700 rounded-lg shadow",children:[(0,a.jsx)("p",{className:"text-lg font-bold text-white",children:e.name}),(0,a.jsx)("p",{className:"text-gray-300",children:e.descripcion}),(0,a.jsxs)("p",{className:"text-gray-300",children:["Precio: $",e.precio]}),(0,a.jsxs)("div",{className:"flex justify-between mt-2",children:[(0,a.jsx)("button",{onClick:()=>n.push("/administracion/plan/".concat(e.id)),className:"px-3 py-1 text-sm text-white bg-blue-600 rounded hover:bg-blue-700",children:"Editar"}),(0,a.jsx)("button",{onClick:()=>c(e.id),className:"px-3 py-1 text-sm text-white bg-red-600 rounded hover:bg-red-700",children:"Eliminar"})]})]},e.id)):(0,a.jsx)("div",{className:"text-center text-gray-300 col-span-full",children:"No se encontraron planes."})}),(0,a.jsx)("button",{onClick:()=>n.push("/administracion/plan/nuevo"),className:"px-4 py-2 mt-4 text-white bg-green-600 rounded hover:bg-green-700",children:"Agregar Nuevo Plan"})]})};var i=r(6461);let o=e=>{let{getAllSubscriptions:t,updateSubscriptionStatus:r,cancelSubscription:s}=e,[n,o]=(0,l.useState)([]),[c,d]=(0,l.useState)(""),[u,m]=(0,l.useState)(null),[g,p]=(0,l.useState)(!0),x=async()=>{try{p(!0);let e=(await t()).map(e=>({...e,user:e.user?{id:e.user.id,email:e.user.email}:{id:"N/A",email:"N/A"}}));o(e)}catch(e){console.error("Error fetching subscriptions:",e)}finally{p(!1)}};(0,l.useEffect)(()=>{x()},[t]);let h=async e=>{try{await r(e,i.i.PAUSED),x()}catch(e){console.error("Error al actualizar la suscripci\xf3n:",e)}},b=async e=>{try{await r(e,i.i.ACTIVE),x()}catch(e){console.error("Error al activar la suscripci\xf3n:",e)}},y=async e=>{try{await s(e,"Cancelado por admin"),x()}catch(e){console.error("Error al cancelar la suscripci\xf3n:",e)}},f=e=>{switch(e){case i.i.ACTIVE:return"bg-green-600";case i.i.PAUSED:return"bg-blue-600";case i.i.CANCELLED:return"bg-red-600";case i.i.PENDING:return"bg-yellow-600";default:return"bg-gray-600"}},w=e=>e?new Date(e).toLocaleDateString():"N/A",N=n.filter(e=>{let t=e.id.toLowerCase().includes(c.toLowerCase())||e.user.email.toLowerCase().includes(c.toLowerCase())||e.plan.name.toLowerCase().includes(c.toLowerCase())||e.mercadopagoSubscriptionId&&e.mercadopagoSubscriptionId.toLowerCase().includes(c.toLowerCase()),r=!0;return null!==u&&(r=e.status===u),t&&r}),j=e=>{u===e?m(null):m(e)};return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"mb-4 text-2xl font-bold text-white",children:"Suscripciones"}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 mb-6 md:flex-row",children:[(0,a.jsx)("input",{type:"text",placeholder:"Buscar por ID, email o plan...",value:c,onChange:e=>d(e.target.value),className:"flex-1 px-4 py-2 text-white bg-gray-700 rounded-lg"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-4",children:Object.values(i.i).map(e=>(0,a.jsx)("button",{onClick:()=>j(e),className:"w-32 px-4 py-2 rounded-lg text-white transition-colors ".concat(u===e?f(e):"bg-gray-700"),children:e},e))})]}),g?(0,a.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,a.jsx)("div",{className:"w-8 h-8 border-4 rounded-full border-t-indigo-600 animate-spin"})}):(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:N.length>0?N.map(e=>(0,a.jsxs)("div",{className:"p-2 bg-gray-700 rounded-lg shadow",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("p",{className:"text-xs font-bold text-white truncate",children:["ID: ",e.id]}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-bold text-white rounded-full ".concat(f(e.status)),children:e.status})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:["UserId",e.user.id]}),(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:["Email: ",e.user.email]}),(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:[(0,a.jsx)("span",{className:"font-medium",children:"Plan:"})," ",e.plan.name]}),(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:[(0,a.jsx)("span",{className:"font-medium",children:"Inicio:"})," ",w(e.fechaInicio)]}),(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:[(0,a.jsx)("span",{className:"font-medium",children:"\xdaltimo pago:"})," ",w(e.fechaUltimaPaga)]}),(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:[(0,a.jsx)("span",{className:"font-medium",children:"Vencimiento:"})," ",w(e.fechaVencimiento)]}),e.mercadopagoSubscriptionId&&(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:[(0,a.jsx)("span",{className:"font-medium",children:"MP ID:"})," ",(0,a.jsx)("span",{className:"text-xs text-gray-400 truncate",children:e.mercadopagoSubscriptionId})]}),e.cancellationDate&&(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:[(0,a.jsx)("span",{className:"font-medium",children:"Cancelada:"})," ",w(e.cancellationDate)]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.status===i.i.ACTIVE&&(0,a.jsx)("button",{onClick:()=>h(e.id),className:"px-3 py-1 text-sm text-white bg-yellow-600 rounded hover:bg-yellow-700",children:"Pausar"}),e.status===i.i.PAUSED&&(0,a.jsx)("button",{onClick:()=>b(e.id),className:"px-3 py-1 text-sm text-white bg-green-600 rounded hover:bg-green-700",children:"Activar"}),e.status===i.i.PENDING&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>b(e.id),className:"px-3 py-1 text-sm text-white bg-green-600 rounded hover:bg-green-700",children:"Aprobar"}),(0,a.jsx)("button",{onClick:()=>y(e.id),className:"px-3 py-1 text-sm text-white bg-red-600 rounded hover:bg-red-700",children:"Cancelar"})]}),(e.status===i.i.ACTIVE||e.status===i.i.PAUSED)&&(0,a.jsx)("button",{onClick:()=>y(e.id),className:"px-3 py-1 text-sm text-white bg-red-600 rounded hover:bg-red-700",children:"Cancelar"})]})]},e.id)):(0,a.jsx)("div",{className:"text-center text-gray-300 col-span-full",children:"No se encontraron suscripciones."})})]})},c=e=>{let{user:t,onClose:r,onEdit:s}=e;return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-11/12 p-6 bg-gray-800 rounded-lg shadow-lg md:w-1/2 lg:w-1/3",children:[(0,a.jsx)("h2",{className:"mb-4 text-2xl font-bold text-white",children:"Detalles del Usuario"}),(0,a.jsx)("div",{className:"space-y-2 text-gray-300",children:Object.entries(t).filter(e=>{let[t]=e;return"password"!==t&&"isAdmin"!==t}).map(e=>{let[t,r]=e;return(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsxs)("span",{className:"mr-2 font-bold",children:[t,":"]}),(0,a.jsx)("span",{children:"object"==typeof r?JSON.stringify(r):String(r)})]},t)})}),(0,a.jsxs)("div",{className:"flex justify-end mt-4",children:[(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 text-white transition-all rounded bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700",children:"Cerrar"}),(0,a.jsx)("button",{onClick:()=>s(t.id),className:"px-4 py-2 ml-2 text-white transition-all rounded bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700",children:"Modificar"})]})]})})},d=e=>{let{getUsers:t,planes:r}=e,n=(0,s.useRouter)(),[i,o]=(0,l.useState)([]),[d,u]=(0,l.useState)(""),[m,g]=(0,l.useState)(null),[p,x]=(0,l.useState)(!1),[h,b]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{try{let e=await t();o(e)}catch(e){console.error("Error fetching users:",e)}})()},[t]);let y=i.filter(e=>{let t=e.name.toLowerCase().includes(d.toLowerCase())||e.email.toLowerCase().includes(d.toLowerCase())||e.id.toLowerCase().includes(d.toLowerCase()),r=!0;if(null!==m){var a;r=null!==(a=e.subscripcion)&&void 0!==a&&!!a.plan&&e.subscripcion.plan.id===m}return t&&r}),f=e=>{m===e?g(null):g(e)},w=e=>{b(e),x(!0)};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 mb-6 md:flex-row",children:[(0,a.jsx)("input",{type:"text",placeholder:"Buscar por nombre, email o ID...",value:d,onChange:e=>u(e.target.value),className:"flex-1 px-4 py-2 text-white bg-gray-700 rounded-lg"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-4",children:r.map(e=>(0,a.jsx)("button",{onClick:()=>f(e.id),className:"w-32 px-4 py-2 rounded-lg text-white transition-colors ".concat(m===e.id?"bg-indigo-600":"bg-gray-700"),children:e.name},e.id))})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:y.length>0?y.map(e=>(0,a.jsxs)("div",{onClick:()=>w(e),className:"relative p-4 transition-colors bg-gray-700 rounded-lg shadow cursor-pointer hover:bg-gray-600",children:[(0,a.jsx)("p",{className:"text-lg font-bold text-white",children:e.name}),e.isAdmin&&(0,a.jsx)("div",{className:"absolute flex items-center justify-center w-4 h-4 text-xs font-bold rounded-full top-2 right-2 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-400 text-neutral-950",children:"A"}),(0,a.jsx)("p",{className:"text-gray-300",children:e.email}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["ID: ",e.id]})]},e.id)):(0,a.jsx)("div",{className:"text-center text-gray-300 col-span-full",children:"No se encontraron usuarios."})}),p&&h&&(0,a.jsx)(c,{user:h,onClose:()=>{b(null),x(!1)},onEdit:e=>{n.push("/user/".concat(e))}})]})};var u=r(7013),m=r(3535);let g=()=>{let{planes:e}=(0,l.useContext)(m.U),{getUsers:t,getAllPlans:r,deletePlan:s,getAllSubscriptions:i,updateSubscriptionStatus:c,cancelSubscription:g}=(0,l.useContext)(u.t),[p,x]=(0,l.useState)("usuarios");return(0,a.jsxs)("section",{className:"w-11/12 px-4 py-3 mx-auto max-w-7xl",children:[(0,a.jsx)("h1",{className:"mb-4 text-3xl font-bold text-white",children:"Panel de Administraci\xf3n"}),(0,a.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,a.jsx)("button",{onClick:()=>x("usuarios"),className:"px-4 py-2 rounded ".concat("usuarios"===p?"bg-indigo-600":"bg-gray-700 text-white"),children:"Usuarios"}),(0,a.jsx)("button",{onClick:()=>x("planes"),className:"px-4 py-2 rounded ".concat("planes"===p?"bg-indigo-600":"bg-gray-700 text-white"),children:"Planes"}),(0,a.jsx)("button",{onClick:()=>x("suscripciones"),className:"px-4 py-2 rounded ".concat("suscripciones"===p?"bg-indigo-600":"bg-gray-700 text-white"),children:"Suscripciones"})]}),"usuarios"===p&&(0,a.jsx)(d,{getUsers:t,planes:e}),"planes"===p&&(0,a.jsx)(n,{getAllPlans:r,deletePlan:s}),"suscripciones"===p&&(0,a.jsx)(o,{getAllSubscriptions:i,updateSubscriptionStatus:c,cancelSubscription:g})]})}},3932:(e,t,r)=>{r.d(t,{A:()=>s});let a=r(2651).A.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>Promise.reject(e));let s=a},7013:(e,t,r)=>{r.d(t,{X:()=>o,t:()=>i});var a=r(5155),s=r(2115),l=r(3932),n=r(2155);let i=(0,s.createContext)({getUsers:async()=>{throw Error("Not implemented")},getUsersSubscribed:async()=>{throw Error("Not implemented")},getUsersSubscribedAt:async()=>{throw Error("Not implemented")},getUser:async()=>{throw Error("Not implemented")},putAdmin:async()=>{throw Error("Not implemented")},getAllPlans:async()=>{throw Error("Not implemented")},createPlan:async()=>{throw Error("Not implemented")},updatePlan:async()=>{throw Error("Not implemented")},deletePlan:async()=>{throw Error("Not implemented")},getAllSubscriptions:async()=>{throw Error("Not implemented")},getSubscriptionById:async()=>{throw Error("Not implemented")},updateSubscriptionStatus:async()=>{throw Error("Not implemented")},cancelSubscription:async()=>{throw Error("Not implemented")}}),o=e=>{let{children:t}=e,r=async()=>{let e=localStorage.getItem("admin_users");if(e)return JSON.parse(e);let{data:t,error:r}=await (0,n.$)(l.A.get("/admin/users"));if(r||!t)throw Error((null==r?void 0:r.message)||"Error al obtener los usuarios.");return localStorage.setItem("admin_users",JSON.stringify(t.data)),t.data},s=async()=>{let e=localStorage.getItem("admin_usersSubscribed");if(e)return console.log("Cargando usuarios suscritos desde localStorage..."),JSON.parse(e);let{data:t,error:r}=await (0,n.$)(l.A.get("/admin/getUsersSubscribed"));if(r||!t)throw Error((null==r?void 0:r.message)||"Error al obtener usuarios suscritos.");return localStorage.setItem("admin_usersSubscribed",JSON.stringify(t.data)),t.data},o=async e=>{let t="admin_usersSubscribed_plan_".concat(e),r=localStorage.getItem(t);if(r)return JSON.parse(r);let{data:a,error:s}=await (0,n.$)(l.A.get("/admin/getUsersSubscribed/".concat(e)));if(s||!a)throw Error((null==s?void 0:s.message)||"Error al obtener usuarios suscritos al plan.");return localStorage.setItem(t,JSON.stringify(a.data)),a.data},c=async e=>{let{data:t,error:r}=await (0,n.$)(l.A.get("/admin/user/".concat(e)));if(r||!t)throw Error((null==r?void 0:r.message)||"Error al obtener el usuario.");return t.data},d=async e=>{let{data:t,error:r}=await (0,n.$)(l.A.put("/admin/admin/".concat(e)));if(r||!t)throw Error((null==r?void 0:r.message)||"Error al asignar rol admin.");return t.data},u=async()=>{let e=localStorage.getItem("admin_plans");if(e)return console.log("Cargando planes desde localStorage..."),JSON.parse(e);let{data:t,error:r}=await (0,n.$)(l.A.get("/admin/plans"));if(r||!t)throw Error((null==r?void 0:r.message)||"Error al obtener planes.");return localStorage.setItem("admin_plans",JSON.stringify(t.data)),t.data},m=async e=>{let{data:t,error:r}=await (0,n.$)(l.A.post("/admin/plans",e));if(r||!t)throw Error((null==r?void 0:r.message)||"Error al crear plan.");return localStorage.removeItem("admin_plans"),t.data},g=async(e,t)=>{let{data:r,error:a}=await (0,n.$)(l.A.put("/admin/plans/".concat(e),t));if(a||!r)throw Error((null==a?void 0:a.message)||"Error al actualizar plan.");return localStorage.removeItem("admin_plans"),r.data},p=async e=>{let{error:t}=await (0,n.$)(l.A.delete("/admin/plans/".concat(e)));if(t)throw Error(t.message||"Error al eliminar plan.");localStorage.removeItem("admin_plans")},x=async()=>{let e=localStorage.getItem("admin_subscriptions");if(e)return console.log("Cargando suscripciones desde localStorage..."),JSON.parse(e);let{data:t,error:r}=await (0,n.$)(l.A.get("/admin/subscriptions"));if(r||!t)throw Error((null==r?void 0:r.message)||"Error al obtener suscripciones.");return localStorage.setItem("admin_subscriptions",JSON.stringify(t.data)),t.data},h=async e=>{let{data:t,error:r}=await (0,n.$)(l.A.get("/admin/subscriptions/".concat(e)));if(r||!t)throw Error((null==r?void 0:r.message)||"Error al obtener suscripci\xf3n.");return t.data},b=async(e,t)=>{let{data:r,error:a}=await (0,n.$)(l.A.put("/admin/subscriptions/".concat(e,"/status"),{status:t}));if(a||!r)throw Error((null==a?void 0:a.message)||"Error al actualizar estado de suscripci\xf3n.");return localStorage.removeItem("admin_subscriptions"),r.data},y=async(e,t)=>{let{data:r,error:a}=await (0,n.$)(l.A.put("/admin/subscriptions/".concat(e,"/cancel"),{reason:t}));if(a||!r)throw Error((null==a?void 0:a.message)||"Error al cancelar suscripci\xf3n.");return localStorage.removeItem("admin_subscriptions"),r.data};return(0,a.jsx)(i.Provider,{value:{getUsers:r,getUsersSubscribed:s,getUsersSubscribedAt:o,getUser:c,putAdmin:d,getAllPlans:u,createPlan:m,updatePlan:g,deletePlan:p,getAllSubscriptions:x,getSubscriptionById:h,updateSubscriptionStatus:b,cancelSubscription:y},children:t})}},3535:(e,t,r)=>{r.d(t,{S:()=>o,U:()=>i});var a=r(5155),s=r(2115),l=r(3932),n=r(2155);let i=(0,s.createContext)({planes:[],viewPlan:null,selectPlan:async()=>null,changePlan:()=>{},getPlanes:async()=>{}}),o=e=>{let{children:t}=e,[r,o]=(0,s.useState)([]),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),g=async()=>{if(!u){m(!0);try{let{data:e,error:t}=await (0,n.$)(l.A.get("/users/planes"));if(t||!(null==e?void 0:e.data)){console.error("Error al obtener planes:",t||"No se retornaron datos");return}let r=e.data;o(r),localStorage.setItem("planes",JSON.stringify(r))}catch(e){console.error("Error en getPlanes:",e)}finally{m(!1)}}},p=async e=>{0===r.length&&await g();let t=r.find(t=>t.id===e);return t?(d(t),localStorage.setItem("viewPlan",JSON.stringify(t)),t):(console.error("Plan no encontrado con ID:",e),null)},x=e=>{if(!c||0===r.length)return;let t=r.findIndex(e=>e.id===c.id);if(-1===t)return;let a="next"===e?t+1:t-1;a<0&&(a=r.length-1),a>=r.length&&(a=0);let s=r[a];d(s),localStorage.setItem("viewPlan",JSON.stringify(s))};(0,s.useEffect)(()=>{(async()=>{let e=localStorage.getItem("planes");if(e)try{let t=JSON.parse(e);o(t)}catch(e){console.error("Error al parsear planes del localStorage:",e),await g()}else await g()})()},[]),(0,s.useEffect)(()=>{if(r.length>0&&!c){let e=localStorage.getItem("viewPlan");if(e)try{d(JSON.parse(e))}catch(e){console.error("Error al parsear viewPlan del localStorage:",e),h()}else h()}},[r,c]);let h=()=>{let e=r.find(e=>!0===e.popular);d(e||r[0]),(e||r[0])&&localStorage.setItem("viewPlan",JSON.stringify(e||r[0]))},b=(0,s.useMemo)(()=>({planes:r,viewPlan:c,selectPlan:p,changePlan:x,getPlanes:g}),[r,c]);return(0,a.jsx)(i.Provider,{value:b,children:t})}},6461:(e,t,r)=>{r.d(t,{i:()=>a});var a=function(e){return e.ACTIVE="active",e.PAUSED="paused",e.CANCELLED="cancelled",e.PENDING="pending",e}({})},6046:(e,t,r)=>{var a=r(6658);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},2155:(e,t,r)=>{r.d(t,{$:()=>a});let a=async e=>{try{return{data:await e}}catch(e){return console.error("Error en handleAsync:",e),{error:e.response?e.response.data:{message:e.message}}}}}}]);