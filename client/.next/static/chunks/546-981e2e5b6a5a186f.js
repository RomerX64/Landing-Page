"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[546],{2546:(e,r,t)=>{t.r(r),t.d(r,{default:()=>d});var a=t(5155),s=t(2115),o=t(6046),l=t(8173),n=t.n(l),i=t(1455),c=t(2783);function d(){let e;let{signUp:r,mailIsValid:t,signUpWithGoogle:l,user:d}=(0,s.useContext)(i.Rs),h=(0,o.useRouter)(),[p,x]=(0,s.useState)({username:"",company:"",email:"",telefono:"",password:"",confirmPassword:""}),[f,w]=(0,s.useState)({phoneError:!1,passwordError:!1,lengthError:!1,emailError:""}),[y,E]=(0,s.useState)(!1);(0,s.useEffect)(()=>{d&&h.push("/")},[d,h]);let v=e=>{let{name:r,value:t}=e.target;x(e=>{let a={...e,[r]:t};return"telefono"===r&&b(t),a})},b=e=>{let r=e.replace(/\s+/g,"");r.startsWith("+54")||(r="+"+r.replace(/^\+?/,""));let t=/^\+54[1-9]\d{1,14}$/;w(e=>({...e,phoneError:!t.test(r)}))},j=async r=>{let a=r.target.value;x(e=>({...e,email:a})),clearTimeout(e),e=setTimeout(async()=>{let e=await t(a);w(r=>({...r,emailError:e?"Este correo ya est\xe1 registrado":""}))},1e3)},N=async e=>{if(e.preventDefault(),!f.phoneError&&!f.passwordError&&!f.lengthError&&!f.emailError)try{E(!0),await r(p),console.log("Registro exitoso. Revise su email para confirmar.")}catch(e){console.error("Error en la solicitud:",e)}finally{E(!1)}},k=async()=>{E(!0);try{await l(),h.push("/")}catch(e){console.error("Error al registrarse con Google",e)}finally{E(!1)}};return(0,a.jsx)("section",{children:(0,a.jsx)("div",{className:"max-w-6xl px-4 mx-auto sm:px-6",children:(0,a.jsxs)("div",{className:"py-12 md:py-20",children:[(0,a.jsx)("div",{className:"pb-12 text-center",children:(0,a.jsx)("h1",{className:"animate-[gradient_6s_linear_infinite] bg-[linear-gradient(to_right,theme(colors.gray.200),theme(colors.indigo.200),theme(colors.gray.50),theme(colors.indigo.300),theme(colors.gray.200))] bg-[length:200%_auto] bg-clip-text font-nacelle text-3xl font-semibold text-transparent md:text-4xl",children:"Crea tu usuario"})}),(0,a.jsxs)("form",{onSubmit:N,className:"mx-auto max-w-[400px]",children:[(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsx)(u,{id:"username",label:"Username",value:p.username,onChange:v,error:"",required:!0}),(0,a.jsx)(u,{id:"company",label:"Nombre de Compa\xf1\xeda",value:p.company,onChange:v,error:"",required:!0}),(0,a.jsx)(u,{id:"email",label:"Work Email",value:p.email,onChange:j,error:f.emailError,required:!0,type:"email"}),f.emailError&&(0,a.jsx)(g,{children:f.emailError}),(0,a.jsx)(u,{id:"telefono",label:"N\xfamero Telef\xf3nico",value:p.telefono,onChange:v,error:f.phoneError?"Formato inv\xe1lido, debe tener el prefijo nacional":"",required:!0}),(0,a.jsx)(m,{password:p.password,confirmPassword:p.confirmPassword,onPasswordChange:e=>{let{name:r,value:t}=e.target;x(e=>{let a={...e,[r]:t},s=a.password,o=a.confirmPassword,l=s.length<5,n=s!==o;return w(e=>({...e,passwordError:n,lengthError:l})),a})},passwordError:f.passwordError,lengthError:f.lengthError})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-5",children:[(0,a.jsx)("button",{type:"submit",className:"btn w-full bg-gradient-to-t from-indigo-600 to-indigo-500 text-white hover:bg-[length:100%_150%]",disabled:y,children:y?(0,a.jsx)(c.A,{className:"animate-spin"}):"Registrarse"}),(0,a.jsxs)("button",{type:"button",onClick:k,disabled:y,className:"flex items-center justify-center w-full text-gray-300 transition-all duration-200 btn bg-gradient-to-b from-gray-800 to-gray-800/60 disabled:opacity-50 disabled:cursor-not-allowed",children:[y?(0,a.jsx)(c.A,{className:"w-5 h-5 mr-2 animate-spin"}):(0,a.jsxs)("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,a.jsx)("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,a.jsx)("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,a.jsx)("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,a.jsx)("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Registrarse con Google"]})]})]}),(0,a.jsxs)("div",{className:"mt-6 text-sm text-center text-indigo-200/65",children:["\xbfYa posee una cuenta?"," ",(0,a.jsx)(n(),{className:"font-medium text-indigo-500",href:"/signin",children:"Logearse"})]})]})})})}let u=e=>{let{id:r,label:t,value:s,onChange:o,error:l,required:n,type:i="text"}=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:r,className:"block mb-1 text-sm font-medium text-indigo-200/65",children:[t," ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{id:r,name:r,type:i,className:"w-full form-input",placeholder:"Ingrese su ".concat(t),value:s,onChange:o,required:n}),l&&(0,a.jsx)("span",{className:"text-xs text-red-500",children:l})]})},m=e=>{let{password:r,confirmPassword:t,onPasswordChange:s,passwordError:o,lengthError:l}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"password",className:"block text-sm font-medium text-indigo-200/65",children:["Contrase\xf1a ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{id:"password",name:"password",type:"password",className:"w-full form-input",placeholder:"Contrase\xf1a (m\xednimo 5 caracteres)",value:r,onChange:s,required:!0}),l&&(0,a.jsx)(g,{children:"La contrase\xf1a debe tener al menos 5 caracteres"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-indigo-200/65",children:["Confirmar contrase\xf1a ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",className:"w-full form-input",placeholder:"Repita la contrase\xf1a",value:t,onChange:s,required:!0}),o&&(0,a.jsx)(g,{children:"Las contrase\xf1as no coinciden"})]})]})},g=e=>{let{children:r}=e;return(0,a.jsx)("span",{className:"text-xs text-red-500",children:r})}},3932:(e,r,t)=>{t.d(r,{A:()=>s});let a=t(2651).A.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let r=localStorage.getItem("token");r&&(e.headers.Authorization="Bearer ".concat(r))}return e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>Promise.reject(e));let s=a},1455:(e,r,t)=>{t.d(r,{Ay:()=>u,Rs:()=>c,vu:()=>d});var a=t(5155),s=t(2115),o=t(3932),l=t(2155),n=t(2615),i=t(9208);let c=(0,s.createContext)({token:"",user:null,signInO:async()=>{throw Error("Not implemented")},signUp:async()=>{throw Error("Not implemented")},deleteUser:async()=>{throw Error("Not implemented")},mailIsValid:async()=>{throw Error("Not implemented")},updateUser:async()=>{throw Error("Not implemented")},signOut:async()=>{throw Error("Not implemented")},signInWithGoogle:async()=>{throw Error("Not implemented")},signUpWithGoogle:async()=>{throw Error("Not implemented")},requestResetPassword:async()=>{throw Error("Not implemented")},resetPassword:async()=>{throw Error("Not implemented")}}),d=e=>{let{children:r}=e,{data:t}=(0,n.useSession)(),[d,u]=(0,s.useState)(null),[m,g]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{if(t&&t.user&&!d)try{let{email:e,name:r}=t.user;e&&r&&await h(e,r)}catch(e){console.error("Error al procesar la sesi\xf3n de Google:",e)}})()},[t]),(0,s.useEffect)(()=>{let e=localStorage.getItem("token")||i.A.get("token"),r=localStorage.getItem("user")||i.A.get("user");if(e&&g(e),r)try{u(JSON.parse(r))}catch(e){console.error("Error al parsear el usuario del localStorage o cookie",e)}},[]);let h=(0,s.useCallback)(async(e,r)=>{try{let{data:t,error:a}=await (0,l.$)(o.A.get("users/email/get/".concat(e)));if(a)return console.warn("Error al consultar existencia del usuario:",a.message),null;if(null==t?void 0:t.data){let{data:r,error:t}=await (0,l.$)(o.A.get("/users/get/".concat(e)));if(t||!r)return console.log("Error al traer el usuario:",null==t?void 0:t.message),null;return u(r.data.User),g(r.data.token),localStorage.setItem("token",r.data.token),localStorage.setItem("user",JSON.stringify(r.data.User)),i.A.set("token",r.data.token,{expires:7}),i.A.set("user",JSON.stringify(r.data.User),{expires:7}),r.data.User}let{data:s,error:n}=await (0,l.$)(o.A.post("/users/crearUser/google",{email:e,name:r}));if(n||!s)return console.log("Error al crear el usuario:",null==n?void 0:n.message),null;return u(s.data),localStorage.setItem("user",JSON.stringify(s.data)),i.A.set("user",JSON.stringify(s.data),{expires:7}),s.data}catch(e){return console.error("Error en el proceso de registro:",e),null}},[]),p=(0,s.useCallback)(async e=>{try{let{data:r,error:t}=await (0,l.$)(o.A.post("/users/signIn",e));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error de inicio de sesi\xf3n");let{User:a,token:s}=r.data;return g(s),u(a),localStorage.setItem("token",s),localStorage.setItem("user",JSON.stringify(a)),i.A.set("token",s,{expires:7}),i.A.set("user",JSON.stringify(a),{expires:7}),a}catch(e){return console.error("Error en signIn:",e),null}},[]),x=(0,s.useCallback)(async e=>{let{data:r,error:t}=await (0,l.$)(o.A.post("/users/signUp",e));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error de registro");let{User:a,token:s}=r.data;return g(s),u(a),localStorage.setItem("token",s),localStorage.setItem("user",JSON.stringify(a)),i.A.set("token",s,{expires:7}),i.A.set("user",JSON.stringify(a),{expires:7}),a},[]),f=(0,s.useCallback)(async e=>{let{data:r,error:t}=await (0,l.$)(o.A.delete("/users/user",{data:e}));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error al eliminar usuario");let a=r.data;return g(""),u(null),localStorage.removeItem("token"),localStorage.removeItem("user"),i.A.remove("token"),i.A.remove("user"),a},[]),w=(0,s.useCallback)(async e=>{try{return(await o.A.get("/users/email/".concat(e))).data}catch(e){return!1}},[]),y=(0,s.useCallback)(async e=>{if(!(null==d?void 0:d.id))throw Error("Usuario no autenticado");let{data:r,error:t}=await (0,l.$)(o.A.put("/users/update/".concat(d.id),{...e}));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error al actualizar usuario");let{User:a,token:s}=r.data;return a},[d]),E=(0,s.useCallback)(async()=>{try{await (0,n.signOut)({redirect:!1}),g(""),u(null),localStorage.removeItem("token"),localStorage.removeItem("user"),i.A.remove("token"),i.A.remove("user")}catch(e){console.error("Error durante el cierre de sesi\xf3n:",e)}},[]),v=(0,s.useCallback)(async()=>{try{return await (0,n.signIn)("google",{callbackUrl:"/"}),null}catch(e){return console.error("Error en signInWithGoogle:",e),null}},[]),b=(0,s.useCallback)(async()=>v(),[v]),j=(0,s.useCallback)(async e=>{let{data:r,error:t}=await (0,l.$)(o.A.post("/users/request-reset-password",{email:e}));if(t||!(null==r?void 0:r.data))throw Error((null==t?void 0:t.message)||"Error al solicitar reset de contrase\xf1a");return r.data},[]),N=(0,s.useCallback)(async(e,r)=>{let{data:t,error:a}=await (0,l.$)(o.A.post("/users/reset-password",{token:e,newPassword:r}));if(a||!(null==t?void 0:t.data))throw Error((null==a?void 0:a.message)||"Error al resetear contrase\xf1a");return t.data},[]),k=(0,s.useMemo)(()=>({token:m,user:d,signInO:p,signUp:x,deleteUser:f,mailIsValid:w,updateUser:y,signOut:E,signInWithGoogle:v,signUpWithGoogle:b,requestResetPassword:j,resetPassword:N}),[d,m,p,x,f,w,y,E,v,b,j,N]);return(0,a.jsx)(c.Provider,{value:k,children:r})},u=c},6046:(e,r,t)=>{var a=t(6658);t.o(a,"useParams")&&t.d(r,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},2155:(e,r,t)=>{t.d(r,{$:()=>a});let a=async e=>{try{return{data:await e}}catch(e){return console.error("Error en handleAsync:",e),{error:e.response?e.response.data:{message:e.message}}}}},2783:(e,r,t)=>{t.d(r,{A:()=>a});let a=(0,t(4057).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}}]);