{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/tomir/OneDrive/Desktop/AssetlyLandingPage/client/app/%28default%29/suscribirse/layout.tsx"],"sourcesContent":["\"use client\";\nimport React, { useContext, useState, useEffect, useRef } from \"react\";\nimport { ChevronLeft } from \"lucide-react\";\nimport { CardPayment } from \"@mercadopago/sdk-react\";\nimport { useRouter } from \"next/navigation\";\nimport { SubscriptionContext } from \"@/context/Suscribe.context\";\nimport { PlansContext } from \"@/context/Planes.context\";\nimport { IAdditionalData, ICardPaymentBrickPayer, ICardPaymentFormData } from \"@mercadopago/sdk-react/esm/bricks/cardPayment/type\";\n\nconst PaymentForm = () => {\n  const { suscribirse, sub } = useContext(SubscriptionContext);\n  const { viewPlan } = useContext(PlansContext);\n  const router = useRouter();\n  const [error, setError] = useState<string | null>(null);\n  const [paymentProcessing, setPaymentProcessing] = useState(false);\n  const [progress, setProgress] = useState(0);\n\n  // Referencia para el contenedor del CardPayment\n  const paymentContainerRef = useRef<HTMLDivElement>(null);\n\n  // Referencia para mantener el formData\n  const formDataRef =\n    useRef<ICardPaymentFormData<ICardPaymentBrickPayer | null>(null);\n\n  // Effect to handle successful subscription and redirect\n  useEffect(() => {\n    if (sub && sub.id) {\n      // Reset progress to full\n      setProgress(100);\n\n      // Short delay to allow progress bar to complete visually\n      const redirectTimer = setTimeout(() => {\n        router.push(\"/success\");\n      }, 500);\n\n      return () => clearTimeout(redirectTimer);\n    }\n  }, [sub, router]);\n\n  // Progress bar effect during payment processing\n  useEffect(() => {\n    let progressInterval: NodeJS.Timeout;\n\n    if (paymentProcessing) {\n      // En lugar de quitar el componente, ocultamos el contenedor con CSS\n      if (paymentContainerRef.current) {\n        paymentContainerRef.current.style.display = \"none\";\n      }\n\n      progressInterval = setInterval(() => {\n        setProgress((prevProgress) => {\n          if (prevProgress >= 90) {\n            clearInterval(progressInterval);\n            return 90;\n          }\n          return prevProgress + 10;\n        });\n      }, 500);\n    } else {\n      // Volvemos a mostrar el contenedor cuando no está procesando\n      if (paymentContainerRef.current) {\n        paymentContainerRef.current.style.display = \"\";\n      }\n    }\n\n    return () => {\n      if (progressInterval) clearInterval(progressInterval);\n    };\n  }, [paymentProcessing]);\n\n  const validateCardData = (\n    formData: ICardPaymentFormData<ICardPaymentBrickPayer>\n  ): boolean => {\n    if (!formData.token) {\n      setError(\"Falta el token de la tarjeta.\");\n      return false;\n    }\n    if (!formData.payment_method_id) {\n      setError(\"Método de pago no seleccionado.\");\n      return false;\n    }\n    return true;\n  };\n\n  const handleFormSubmit = async (\n    formData: ICardPaymentFormData<ICardPaymentBrickPayer>,\n    additionalData?: IAdditionalData\n  ): Promise<void> => {\n    if (!viewPlan) return;\n\n    // Guardamos el formData en la referencia\n    formDataRef.current = formData;\n\n    if (!validateCardData(formData)) return;\n\n    try {\n      const paymentMethodToken = formData.token;\n\n      // Verificamos que el email existe\n      if (!formData.payer?.email) {\n        setError(\"Falta el email del pagador.\");\n        return;\n      }\n\n      setPaymentProcessing(true);\n      setProgress(10);\n      await suscribirse(viewPlan.id, paymentMethodToken, formData.payer.email);\n    } catch (error) {\n      console.error(\"Error al procesar el pago:\", error);\n      setError(\"Hubo un error al procesar el pago. Intenta nuevamente.\");\n      setPaymentProcessing(false);\n      setProgress(0);\n    }\n  };\n\n  return (\n    <section className=\"w-10/12 max-w-3xl px-1 py-5 mx-auto\">\n      {/* Progress bar */}\n      {(paymentProcessing || progress > 0) && (\n        <div\n          className=\"fixed top-0 left-0 z-50 h-1 transition-all duration-300 ease-out bg-blue-500\"\n          style={{ width: `${progress}%` }}\n        />\n      )}\n\n      <div className=\"p-8 bg-gray-800 shadow-2xl rounded-2xl\">\n        <div className=\"flex items-center mb-6\">\n          <button\n            onClick={() => router.back()}\n            className=\"p-2 mr-4 text-white bg-gray-700 rounded-full hover:bg-gray-600\"\n            disabled={paymentProcessing}\n          >\n            <ChevronLeft size={24} />\n          </button>\n          <h2 className=\"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400\">\n            Completa tu Pago\n          </h2>\n        </div>\n\n        {viewPlan && (\n          <div className=\"mb-3\">\n            <p className=\"text-gray-300\">\n              Estás suscribiéndote al plan{\" \"}\n              <span className=\"font-bold\">{viewPlan.name}</span> por{\" \"}\n              <span className=\"font-bold\">\n                ${viewPlan.precio} dólares mensuales\n              </span>\n              .\n            </p>\n            {error && <p className=\"text-xl text-red-400 rounded\">{error}</p>}\n          </div>\n        )}\n\n        {paymentProcessing && (\n          <div className=\"py-6 text-center\">\n            <p className=\"text-xl text-gray-300\">Procesando tu pago...</p>\n            <p className=\"text-gray-400\">Por favor, no cierres esta ventana.</p>\n          </div>\n        )}\n\n        {/* Utilizamos la referencia en el contenedor del CardPayment */}\n        <div id=\"cardPaymentBrick_container\" ref={paymentContainerRef}>\n          <CardPayment\n            key=\"payment-form\"\n            initialization={{ amount: viewPlan ? viewPlan.precio : 0 }}\n            onSubmit={handleFormSubmit}\n            onError={(err: any) => {\n              console.error(\"Error en el Brick de Pago:\", err);\n              setError(\n                \"Hubo un error al procesar el pago. Intenta nuevamente.\"\n              );\n            }}\n            customization={{\n              visual: {\n                style: {\n                  theme: \"dark\",\n                },\n              },\n              paymentMethods: {\n                types: {\n                  included: [\"credit_card\", \"debit_card\", \"prepaid_card\"],\n                },\n                minInstallments: 1,\n                maxInstallments: 12,\n              },\n            }}\n          />\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default PaymentForm;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 322, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 332, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/tomir/OneDrive/Desktop/AssetlyLandingPage/client/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0]}},
    {"offset": {"line": 333, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 339, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 341, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 347, "column": 0}, "map": {"version":3,"file":"chevron-left.js","sources":["file://C%3A/Users/tomir/OneDrive/Desktop/AssetlyLandingPage/client/node_modules/lucide-react/src/icons/chevron-left.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'm15 18-6-6 6-6', key: '1wnfg3' }]];\n\n/**\n * @component @name ChevronLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTUgMTgtNi02IDYtNiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/chevron-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ChevronLeft = createLucideIcon('ChevronLeft', __iconNode);\n\nexport default ChevronLeft;\n"],"names":[],"mappings":";;;;;;;;;;;AAGa,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,UAAA,CAAuB,CAAA,CAAA;IAAC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ;QAAA,CAAE;YAAA,EAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAkB;YAAA,CAAA,CAAA,CAAA,CAAA,CAAK,CAAS,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAC;KAAC;CAAA,CAAA;AAa/E,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,WAAA,CAAc,CAAA,2KAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAiB,AAAjB,CAAA,CAAA,AAAiB,CAAjB,AAAiB,CAAjB,AAAiB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAe,CAAU,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA","ignoreList":[0]}},
    {"offset": {"line": 370, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}