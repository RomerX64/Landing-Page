"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8232],{8232:(r,e,a)=>{a.d(e,{d:()=>u,h:()=>c});var t=a(5155),o=a(2115),s=a(2793),l=a(2155),i=a(1455),n=a(4357);let c=(0,o.createContext)({sub:null,suscribirse:async()=>({success:!1}),desuscribirse:async()=>!1,fetchSub:async()=>null,isLoading:!1,mpInitialized:!1}),u=r=>{let{children:e}=r,{user:a}=(0,o.useContext)(i.Ay),[u,d]=(0,o.useState)(null),[p,g]=(0,o.useState)(!1),[y,m]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(()=>{try{return(0,n.Lz)("APP_USR-8c3216f3-8ec0-4106-9522-f580b88cf1c4"),m(!0),!0}catch(r){return console.error("Error al inicializar Mercado Pago:",r),!1}})()},[]);let f=async(r,e,t)=>{g(!0);try{var o,i,n;if(!y)return{success:!1,error:"Error al inicializar el servicio de pagos. Por favor, recarga la p\xe1gina."};if(!(null==a?void 0:a.id))return{success:!1,error:"Usuario no identificado"};let{data:c,error:u}=await (0,l.$)(s.A.post("/subscriptions",{planId:r,userEmail:t,paymentMethodToken:e,userId:a.email||t}));if(u){let r=(null===(n=u.response)||void 0===n?void 0:null===(i=n.data)||void 0===i?void 0:i.message)||"Error al procesar la suscripci\xf3n";return console.error("Error al suscribirse:",r),{success:!1,error:r}}if(!(null==c?void 0:null===(o=c.data)||void 0===o?void 0:o.subscription))return{success:!1,error:"No se recibieron datos de la suscripci\xf3n"};let p=c.data.subscription;return d(p),localStorage.setItem("subscripcion_".concat(a.id),JSON.stringify(p)),{success:!0}}catch(e){let r=e.message||"Error inesperado al suscribirse";return console.error("Excepci\xf3n en suscribirse:",e),{success:!1,error:r}}finally{g(!1)}},h=async r=>{g(!0);try{if(!u||!u.id)return console.error("No hay suscripci\xf3n activa para cancelar"),!1;let{data:e,error:t}=await (0,l.$)(s.A.post("/subscriptions/cancel",{subscriptionId:u.id,cancellationReason:r||"Cancelado por el usuario"}));if(t||!(null==e?void 0:e.data))return console.error("Error al cancelar la suscripci\xf3n:",t||"No se retornaron datos"),!1;let o=e.data.subscription;return d(o),(null==a?void 0:a.id)&&o?localStorage.setItem("subscripcion_".concat(a.id),JSON.stringify(o)):(null==a?void 0:a.id)&&localStorage.removeItem("subscripcion_".concat(a.id)),!0}catch(r){return console.error("Excepci\xf3n en desuscribirse:",r),!1}finally{g(!1)}},E=async()=>{if(!a)return d(null),null;g(!0);try{if(a.subscripcion)return d(a.subscripcion),localStorage.setItem("subscripcion_".concat(a.id),JSON.stringify(a.subscripcion)),a.subscripcion;let{data:e,error:t}=await (0,l.$)(s.A.get("/users/sub/".concat(a.id)));if(t){var r;if((null===(r=t.response)||void 0===r?void 0:r.status)===404)return d(null),localStorage.removeItem("subscripcion_".concat(a.id)),null;return console.error("Error al obtener la suscripci\xf3n:",t),null}if(!(null==e?void 0:e.data))return d(null),localStorage.removeItem("subscripcion_".concat(a.id)),null;return d(e.data),localStorage.setItem("subscripcion_".concat(a.id),JSON.stringify(e.data)),e.data}catch(r){return console.error("Error inesperado al obtener suscripci\xf3n:",r),null}finally{g(!1)}};(0,o.useEffect)(()=>{if(d(null),!a)return;let r=localStorage.getItem("subscripcion_".concat(a.id));if(r)try{d(JSON.parse(r))}catch(r){console.error("Error al parsear suscripci\xf3n del localStorage:",r)}else E()},[a]);let b=(0,o.useMemo)(()=>({sub:u,suscribirse:f,desuscribirse:h,fetchSub:E,isLoading:p,mpInitialized:y}),[u,p,y,a]);return(0,t.jsx)(c.Provider,{value:b,children:e})}},1455:(r,e,a)=>{a.d(e,{Ay:()=>d,Rs:()=>c,vu:()=>u});var t=a(5155),o=a(2115),s=a(2793),l=a(2155),i=a(2615),n=a(9208);let c=(0,o.createContext)({token:"",user:null,signInO:async()=>{throw Error("Not implemented")},signUp:async()=>{throw Error("Not implemented")},deleteUser:async()=>{throw Error("Not implemented")},mailIsValid:async()=>{throw Error("Not implemented")},updateUser:async()=>{throw Error("Not implemented")},signOut:async()=>{throw Error("Not implemented")},signInWithGoogle:async()=>{throw Error("Not implemented")},signUpWithGoogle:async()=>{throw Error("Not implemented")},requestResetPassword:async()=>{throw Error("Not implemented")},resetPassword:async()=>{throw Error("Not implemented")},verifyEmail:async()=>{throw Error("Not implemented")},initiatePasswordReset:async()=>{throw Error("Not implemented")},isLoading:!1}),u=r=>{let{children:e}=r,{data:a}=(0,i.useSession)(),[u,d]=(0,o.useState)(null),[p,g]=(0,o.useState)(""),[y,m]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{if(a&&a.user&&!u)try{m(!0);let{email:r,name:e}=a.user;r&&e&&await E(r,e)}catch(r){console.error("Error al procesar la sesi\xf3n de Google:",r)}finally{m(!1)}})()},[a,u]),(0,o.useEffect)(()=>{let r=localStorage.getItem("token")||n.A.get("token"),e=localStorage.getItem("user")||n.A.get("user");if(r&&g(r),e)try{d(JSON.parse(e))}catch(r){console.error("Error al parsear el usuario del localStorage o cookie",r)}},[]);let f=(0,o.useCallback)((r,e)=>{localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(r)),n.A.set("token",e,{expires:7}),n.A.set("user",JSON.stringify(r),{expires:7})},[]),h=(0,o.useCallback)(()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),n.A.remove("token"),n.A.remove("user"),Object.keys(localStorage).forEach(r=>{r.startsWith("subscripcion_")&&localStorage.removeItem(r)})},[]),E=(0,o.useCallback)(async(r,e)=>{try{m(!0);let{data:a,error:t}=await (0,l.$)(s.A.get("users/email/get/".concat(r)));if(t)throw Error(t.message);if(null==a?void 0:a.data){let{data:e,error:a}=await (0,l.$)(s.A.get("/users/get/".concat(r)));if(a||!e)throw Error((null==a?void 0:a.message)||"Error al obtener usuario existente");return d(e.data.User),g(e.data.token),f(e.data.User,e.data.token),e.data.User}let{data:o,error:i}=await (0,l.$)(s.A.post("/users/crearUser/google",{email:r,name:e}));if(i||!o)throw Error((null==i?void 0:i.message)||"Error al crear usuario");return d(o.data),g(o.data.token),f(o.data,o.data.token),o.data}catch(r){throw console.error("Error en el proceso de registro:",r),r}finally{m(!1)}},[f]),b=(0,o.useCallback)(async r=>{try{m(!0);let{data:e,error:a}=await (0,l.$)(s.A.post("/users/signIn",r));if(a||!(null==e?void 0:e.data))throw Error((null==a?void 0:a.message)||"Error de inicio de sesi\xf3n");let{User:t,token:o}=e.data;return g(o),d(t),f(t,o),t}catch(r){return console.error("Error en signIn:",r),null}finally{m(!1)}},[f]),v=(0,o.useCallback)(async r=>{try{m(!0);let{data:e,error:a}=await (0,l.$)(s.A.post("/users/signUp",r));if(a||!(null==e?void 0:e.data))throw Error((null==a?void 0:a.message)||"Error de registro");let{user:t,token:o}=e.data;return g(o),d(t),f(t,o),t}catch(r){throw console.error("Error en signUp:",r),r}finally{m(!1)}},[f]),w=(0,o.useCallback)(async r=>{try{m(!0);let{data:e,error:a}=await (0,l.$)(s.A.delete("/users/user",{data:r}));if(a||!(null==e?void 0:e.data))throw Error((null==a?void 0:a.message)||"Error al eliminar usuario");let t=e.data;return g(""),d(null),h(),t}catch(r){throw console.error("Error al eliminar usuario:",r),r}finally{m(!1)}},[h]),S=(0,o.useCallback)(async r=>{try{return m(!0),(await s.A.get("/users/email/".concat(r))).data}catch(r){return!1}finally{m(!1)}},[]),k=(0,o.useCallback)(async r=>{if(!(null==u?void 0:u.id))throw Error("Usuario no autenticado");try{m(!0);let{data:e,error:a}=await (0,l.$)(s.A.put("/users/update/".concat(u.id),{...r}));if(a||!(null==e?void 0:e.data))throw Error((null==a?void 0:a.message)||"Error al actualizar usuario");let{user:t,token:o}=e.data;return t&&(d(t),f(t,o||p)),t}catch(r){throw console.error("Error al actualizar usuario:",r),r}finally{m(!1)}},[u,f,p]),A=(0,o.useCallback)(async()=>{try{m(!0),await (0,i.signOut)({redirect:!1}),g(""),d(null),h()}catch(r){console.error("Error durante el cierre de sesi\xf3n:",r)}finally{m(!1)}},[h]),I=(0,o.useCallback)(async()=>{try{return m(!0),await (0,i.signIn)("google",{callbackUrl:"/"}),null}catch(r){return console.error("Error en signInWithGoogle:",r),null}finally{m(!1)}},[]),N=(0,o.useCallback)(async()=>I(),[I]),C=(0,o.useCallback)(async r=>{try{m(!0);let{data:e,error:a}=await (0,l.$)(s.A.post("/users/verify-email",{token:r}));if(a||!(null==e?void 0:e.data))throw Error((null==a?void 0:a.message)||"Error al verificar email");if(u&&u.id===e.data.user.id){let r={...e.data.user};d(r),localStorage.setItem("user",JSON.stringify(r)),n.A.set("user",JSON.stringify(r),{expires:7})}return e.data}catch(r){throw console.error("Error al verificar email:",r),r}finally{m(!1)}},[u]),U=(0,o.useCallback)(async r=>{try{m(!0);let{data:e,error:a}=await (0,l.$)(s.A.get("/users/initiate-password-reset/".concat(r)));if(a||!(null==e?void 0:e.data))throw Error((null==a?void 0:a.message)||"Error al solicitar restablecimiento de contrase\xf1a");return e.data}catch(r){throw console.error("Error al iniciar restablecimiento de contrase\xf1a:",r),r}finally{m(!1)}},[]),O=(0,o.useCallback)(async(r,e)=>{try{m(!0);let{data:a,error:t}=await (0,l.$)(s.A.post("/users/reset-password",{token:r,newPassword:e}));if(t||!(null==a?void 0:a.data))throw Error((null==t?void 0:t.message)||"Error al restablecer contrase\xf1a");return a.data}catch(r){throw console.error("Error al restablecer contrase\xf1a:",r),r}finally{m(!1)}},[]),$=(0,o.useMemo)(()=>({token:p,user:u,signInO:b,signUp:v,deleteUser:w,mailIsValid:S,updateUser:k,signOut:A,signInWithGoogle:I,signUpWithGoogle:N,verifyEmail:C,initiatePasswordReset:U,resetPassword:O,requestResetPassword:U,isLoading:y}),[p,u,b,v,w,S,k,A,I,N,C,U,O,y]);return(0,t.jsx)(c.Provider,{value:$,children:e})},d=c},2793:(r,e,a)=>{a.d(e,{A:()=>o});let t=a(2651).A.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});t.interceptors.request.use(r=>{{let e=localStorage.getItem("token");e&&(r.headers.Authorization="Bearer ".concat(e))}return r},r=>Promise.reject(r)),t.interceptors.response.use(r=>r,r=>Promise.reject(r));let o=t},2155:(r,e,a)=>{a.d(e,{$:()=>t});let t=async r=>{try{return{data:await r}}catch(r){return console.error("Error en handleAsync:",r),{error:r.response?r.response.data:{message:r.message}}}}}}]);